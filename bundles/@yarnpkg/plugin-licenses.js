/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-licenses",
factory: function (require) {
var plugin;plugin=(()=>{"use strict";var __webpack_modules__={610:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O,getTree:()=>U});var r={};n.r(r),n.d(r,{getLicense:()=>u,getPackageManifest:()=>p});const i=require("@yarnpkg/cli");var o=n(966);const a=require("clipanion");var _=n(300);const s=require("@yarnpkg/parsers"),c=require("fs");var l=n(688);const p=(e,t)=>{f(e);const n=o.structUtils.convertPackageToLocator(t),r=d[o.structUtils.stringifyLocator(n)];if(!r)return null;const i=r.locations[0],a=i?l.ppath.join(i,l.Filename.manifest):l.Filename.manifest,_=l.npath.fromPortablePath(a),s=(0,c.readFileSync)(_).toString();return JSON.parse(s)},u=(e,t)=>{f(e);const n=o.structUtils.convertPackageToLocator(t),r=d[o.structUtils.stringifyLocator(n)];if(!r)return null;const i=r.locations[0],a=i?l.ppath.join(i,"LICENSE"):"LICENSE",_=l.npath.fromPortablePath(a);return(0,c.readFileSync)(_).toString()};let d;const f=e=>{if(!d){const t=l.ppath.join(e.configuration.projectCwd,l.Filename.nodeModules,".yarn-state.yml"),n=l.npath.fromPortablePath(t);d=(0,s.parseSyml)((0,c.readFileSync)(n).toString())}},g=e=>{switch(e){case"pnp":return _;case"node-modules":return r;default:throw new Error("Unsupported linker")}};var k=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var _=e.length-1;_>=0;_--)(i=e[_])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};const y=require("util").promisify(c.writeFile),m='\n<html>\n<head>\n<style>\n.entry {\n    background-color: lightyellow;\n    padding: 8px;\n    margin-bottom: 8px;\n}\na {\n    color: darkblue;\n}\nlabel {\n  float: right;\n}\nlabel::before {\n  color: darkblue;\n  text-decoration: underline;\n}\n.right {\n    float: right;\n}\ninput + label + pre {\n    display: none;\n}\ninput + label::before {\n    content: "show";\n    cursor: pointer;\n}\ninput:checked + label + pre {\n    display: block;\n}\ninput:checked + label::before {\n    content: "hide ";\n    cursor: pointer;\n}\n</style>\n</style>\n</head>\n<body>\n'.substr(1),h=(e,t,n,r,i,o)=>`\n<div class="entry">\n    <span>${t}${i?" by "+i:""}</span>\n    ${n?`(<a target="_blank" href="${n}">Homepage</a>)`:""}\n    ${o?`<input type="checkbox" hidden id="${e}">\n    <label for="${e}"> ${r||"unknown"} license</label>\n    <pre>${o}</pre>`:`<span class="right">${r||"unknown"} license</span>`}\n</div>\n`.substr(1),b="\n</body>\n</html>\n".substr(1);class P extends a.Command{constructor(){super(...arguments),this.recursive=!1,this.output="licenses.html"}async execute(){const e=await o.Configuration.find(this.context.cwd,this.context.plugins),{project:t,workspace:n}=await o.Project.find(e,this.context.cwd);if(!n)throw new i.WorkspaceRequiredError(t.cwd,this.context.cwd);let r;await t.restoreInstallState(),r=this.recursive?t.storedDescriptors.values():t.workspaces.flatMap(e=>{const t=[e.anchoredDescriptor];return t.push(...e.dependencies.values()),t});const a=o.miscUtils.sortMap(r,e=>o.structUtils.stringifyDescriptor(e)),_=g(t.configuration.get("nodeLinker"));let s=m,c=0;const l=new Set;for(const e of a.values()){const n=t.storedResolutions.get(e.descriptorHash),r=t.storedPackages.get(n),i=(o.structUtils.convertPackageToLocator(r),_.getPackageManifest(t,r));if(!i)continue;if(l.has(i.name))continue;const{license:a,url:p,vendorName:u,vendorUrl:d}=E(i);let f="";try{f=_.getLicense(t,r)}catch(e){}s+=h(c++,i.name,d||p,a,u,f),l.add(i.name)}s+=b,await y(this.output,s)}}P.usage=a.Command.Usage({description:"produces an html file containing the licenses for all packages in the project",details:"\n      This command produces an html file containing the license information for packages in the project. By default, only direct dependencies are included.\n\n      If `-R,--recursive` is set, the listing will include transitive dependencies (dependencies of direct dependencies).\n    ",examples:[["List all licenses of direct dependencies","$0 licenses list"],["List all licenses of direct and transitive dependencies","$0 licenses list --recursive"]]}),k([a.Command.Boolean("-R,--recursive")],P.prototype,"recursive",void 0),k([a.Command.Boolean("-O,--output")],P.prototype,"output",void 0),k([a.Command.Path("licenses","html")],P.prototype,"execute",null);const E=e=>{const{license:t,repository:n,homepage:r,author:i}=e;return{license:("string"!=typeof t?null==t?void 0:t.type:t)||"UNKNOWN",url:(null==n?void 0:n.url)||r,vendorName:null==i?void 0:i.name,vendorUrl:r||(null==i?void 0:i.url)}};var v=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var _=e.length-1;_>=0;_--)(i=e[_])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class w extends a.Command{constructor(){super(...arguments),this.recursive=!1,this.json=!1}async execute(){const e=await o.Configuration.find(this.context.cwd,this.context.plugins),{project:t,workspace:n}=await o.Project.find(e,this.context.cwd);if(!n)throw new i.WorkspaceRequiredError(t.cwd,this.context.cwd);await t.restoreInstallState();const r=await U(t,this.json,this.recursive);o.treeUtils.emitTree(r,{configuration:e,stdout:this.context.stdout,json:this.json,separators:1})}}w.usage=a.Command.Usage({description:"display the licenses for all packages in the project",details:"\n      This command prints the license information for packages in the project. By default, only direct dependencies are listed.\n\n      If `-R,--recursive` is set, the listing will include transitive dependencies (dependencies of direct dependencies).\n    ",examples:[["List all licenses of direct dependencies","$0 licenses list"],["List all licenses of direct and transitive dependencies","$0 licenses list --recursive"]]}),v([a.Command.Boolean("-R,--recursive")],w.prototype,"recursive",void 0),v([a.Command.Boolean("--json")],w.prototype,"json",void 0),v([a.Command.Path("licenses","list")],w.prototype,"execute",null);const O={commands:[w,P]},U=async(e,t,n)=>{const r={},i={children:r};let a;a=n?e.storedDescriptors.values():e.workspaces.flatMap(e=>{const t=[e.anchoredDescriptor];return t.push(...e.dependencies.values()),t});const _=o.miscUtils.sortMap(a,e=>o.structUtils.stringifyDescriptor(e)),s=g(e.configuration.get("nodeLinker"));for(const n of _.values()){const i=e.storedResolutions.get(n.descriptorHash),a=e.storedPackages.get(i),_=o.structUtils.convertPackageToLocator(a),c=s.getPackageManifest(e,a);if(!c)continue;const{license:l,url:p,vendorName:u,vendorUrl:d}=M(c);r[l]||(r[l]={value:o.formatUtils.tuple(o.formatUtils.Type.NO_HINT,l),children:{}});const f={value:o.formatUtils.tuple(o.formatUtils.Type.DEPENDENT,{locator:_,descriptor:n}),children:{...p?{url:{value:o.formatUtils.tuple(o.formatUtils.Type.NO_HINT,D("URL",p,t))}}:{},...u?{vendorName:{value:o.formatUtils.tuple(o.formatUtils.Type.NO_HINT,D("VendorName",u,t))}}:{},...d?{vendorUrl:{value:o.formatUtils.tuple(o.formatUtils.Type.NO_HINT,D("VendorUrl",d,t))}}:{}}},g=o.structUtils.stringifyLocator(_);r[l].children[g]=f}return i},M=e=>{const{license:t,repository:n,homepage:r,author:i}=e;return{license:("string"!=typeof t?null==t?void 0:t.type:t)||"UNKNOWN",url:(null==n?void 0:n.url)||r,vendorName:null==i?void 0:i.name,vendorUrl:r||(null==i?void 0:i.url)}},D=(e,t,n)=>n?t:`${e}: ${t}`},300:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getPackageManifest:()=>getPackageManifest,getLicense:()=>getLicense});var _yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(966),_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__),_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(688),_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__),_yarnpkg_libzip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(76),_yarnpkg_libzip__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_yarnpkg_libzip__WEBPACK_IMPORTED_MODULE_2__),_yarnpkg_plugin_pnp__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(798),_yarnpkg_plugin_pnp__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_yarnpkg_plugin_pnp__WEBPACK_IMPORTED_MODULE_3__);const getPackageManifest=(e,t)=>{makePnPApi(e);const n=_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__.structUtils.convertPackageToLocator(t),r={name:_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__.structUtils.stringifyIdent(n),reference:n.reference},i=pnpApi.getPackageInformation(r);if(!i)return;const{packageLocation:o}=i,a=_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__.ppath.join("/"+o.slice(0,-1).replace(/\\/g,"/"),_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__.Filename.manifest),_=fs.readFileSync(a).toString();return JSON.parse(_)},getLicense=(e,t)=>{makePnPApi(e);const n=_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__.structUtils.convertPackageToLocator(t),r={name:_yarnpkg_core__WEBPACK_IMPORTED_MODULE_0__.structUtils.stringifyIdent(n),reference:n.reference},i=pnpApi.getPackageInformation(r);if(!i)return;const{packageLocation:o}=i,a=_yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__.ppath.join("/"+o.slice(0,-1).replace(/\\/g,"/"),"LICENSE");return fs.readFileSync(a).toString()};let pnpApi;const makePnPApi=project=>{pnpApi||(pnpApi=eval("module.require")((0,_yarnpkg_plugin_pnp__WEBPACK_IMPORTED_MODULE_3__.getPnpPath)(project).main.substr(1)))},fs=new _yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__.VirtualFS({baseFs:new _yarnpkg_fslib__WEBPACK_IMPORTED_MODULE_1__.ZipOpenFS({libzip:(0,_yarnpkg_libzip__WEBPACK_IMPORTED_MODULE_2__.getLibzipSync)(),readOnlyArchives:!0})})},966:e=>{e.exports=require("@yarnpkg/core")},688:e=>{e.exports=require("@yarnpkg/fslib")},76:e=>{e.exports=require("@yarnpkg/libzip")},798:e=>{e.exports=require("@yarnpkg/plugin-pnp")}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}return __webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__(610)})();
return plugin;
}
};